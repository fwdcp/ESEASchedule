<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-input/paper-input-decorator.html">

<polymer-element name="eseaschedule-controls">
    <template>
        <link rel="stylesheet" href="../bower_components/materialize/dist/css/materialize.min.css">

        <div class="row">
            <div class="col m4">
                <template repeat="{{region in regions}}">
                    <core-label>
                        <paper-checkbox for checked value="{{region.id}}"></paper-checkbox>
                        {{region.name}}
                    </core-label>
                    <br />
                </template>
            </div>

            <div class="col m4">
                <template repeat="{{game in games}}">
                    <core-label>
                        <paper-checkbox for checked value="{{game.id}}"></paper-checkbox>
                        {{game.name}}
                    </core-label>
                    <br />
                </template>
            </div>

            <div class="col m4">
                <template repeat="{{division in divisions}}">
                    <core-label>
                        <paper-checkbox for checked value="{{division.id}}"></paper-checkbox>
                        {{division.name}}
                    </core-label>
                    <br />
                </template>
            </div>
        </div>

        <paper-input-decorator label="Start Date">
            <input is="core-input" type="date" min="{{oldestDate | dateValueFormatter}}" max="{{endDate | dateValueFormatter}}" value="{{startDate | dateValueFormatter}}" on-commit="{{changeStartDate}}" preventInvalidInput></input>
        </paper-input-decorator>

        <paper-input-decorator label="End Date">
            <input is="core-input" type="date" min="{{startDate | dateValueFormatter}}" max="{{newestDate | dateValueFormatter}}" value="{{endDate | dateValueFormatter}}" on-commit="{{changeEndDate}}" preventInvalidInput></input>
        </paper-input-decorator>

        <core-ajax
        url="/filters.json"
        handleAs="json"
        auto
        on-core-response="{{getFilters}}"></core-ajax>
    </template>
    <script>
    Polymer({
        "oldestDate": new Date(2008, 10, 24),
        "newestDate": new Date(),
        "startDate": new Date(),
        "endDate": new Date(),
        "regions": [],
        "games": [],
        "divisions": [],
        "getFilters": function(event, detail, sender) {
            if (sender.response) {
                this.regions = sender.response.regions;
                this.games = sender.response.games;
                this.divisions = sender.response.divisions;
                this.startDate = new Date(sender.response.weekBegin);
                this.endDate = new Date(sender.response.weekEnd);
                this.oldestDate = new Date(sender.response.oldestDate);
                this.newestDate = new Date(sender.response.nextWeekEnd);
            }
        },
        "dateValueFormatter": function(value) {
            var yyyy = value.getFullYear().toString();
            var mm = (value.getMonth() + 1).toString();
            var dd = value.getDate().toString();
            return yyyy + "-" + (mm[1] ? mm : "0" + mm[0]) + "-" + (dd[1] ? dd : "0" + dd[0]);
        },
        "changeStartDate": function(event, detail, sender) {
            this.startDate = new Date(sender.committedValue);
        },
        "changeEndDate": function(event, detail, sender) {
            this.endDate = new Date(sender.committedValue);
        }
    });
</script>
</polymer-element>
